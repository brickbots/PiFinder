use nix

# Auto-setup venv in python/ directory
VENV_DIR="python/.venv"

if [[ ! -d "$VENV_DIR" ]]; then
    echo "Creating Python 3.9 virtual environment..."
    python3.9 -m venv "$VENV_DIR"
fi

source "$VENV_DIR/bin/activate"

# Install requirements if venv was just created or requirements changed
MARKER="$VENV_DIR/.requirements_installed"
REQ_HASH=$(cat python/requirements.txt python/requirements_dev.txt 2>/dev/null | sha256sum | cut -d' ' -f1)

if [[ ! -f "$MARKER" ]] || [[ "$(cat "$MARKER" 2>/dev/null)" != "$REQ_HASH" ]]; then
    echo "Installing requirements..."
    pip install -q --upgrade pip
    pip install -q -r python/requirements.txt
    pip install -q -r python/requirements_dev.txt
    echo "$REQ_HASH" > "$MARKER"
fi
